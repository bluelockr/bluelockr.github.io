---
title: Virtualbox Rocky Linux 9.2ì— Kubernetes Cluster ì„¤ì¹˜í•˜ëŠ” ë²•
description: How to set Kubernetes Cluster to Rocky Linux 9.2 in Virtualbox
slug: rocky_kube_cluster_setup
date: 2023-09-21 00:00:00+0000
image: 
tags:
    - RHEL
    - Virtualbox
    - Kubernetes
---

> [!WARNING]  
> ê¸€ ë³µêµ¬ ì¤‘ì…ë‹ˆë‹¤

ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜í•˜ì‹¤ ì •ë„ë©´ ì–´ëŠ ì •ë„ëŠ” ê¸°ë³¸ê¸°ê°€ ìˆìœ¼ì‹  ë¶„ì´ë¼ê³  ê°€ì •í•˜ê³  ê·¸ëƒ¥ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

## Virtualboxì— Rocky Linux ì„¤ì¹˜

ë‹¤ë¥¸ ë¸”ë¡œê·¸ì˜ ê¸€ì„ ì°¸ì¡°í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
  
  
## â­ë„¤íŠ¸ì›Œí¬ ì„¤ì •

**ì €ëŠ” í˜¸ìŠ¤íŠ¸ ì•„ì´í”¼ ëŒ€ì—­ì´ 192.168.0.0/24ë¼ì„œ,**  
**ê²ŒìŠ¤íŠ¸ ì•„ì´í”¼ëŠ” í˜¸ìŠ¤íŠ¸ ì•„ì´í”¼ ëŒ€ì—­ ë‚´ì¸ 192.168.0.10ê³¼ 20ìœ¼ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.**

### ğŸ’§ë²„ì¶”ì–¼ë°•ìŠ¤ ìì²´ ë„¤íŠ¸ì›Œí¬ ì„¤ì •

![Alt text](/../../images/2023/2023-09-21_2_ubuntu_kube/1.png)  
  
![Alt text](/../../images/2023/2023-09-21_2_ubuntu_kube/2.png)  

<span style="background-color:khaki"> **\[NAT Networks\]** </span>  
**Name : NatNetwork**  
**IP Prefix : 192.168.0.0/24**  
**Enable DHCP**  

### ğŸ’§Rocky Linuxê°€ ì„¤ì¹˜ëœ ê°€ìƒë¨¸ì‹ (VM) ì„¤ì •

![Alt text](/../../images/2023/2023-09-21_2_ubuntu_kube/3.png)  

<span style="background-color:khaki"> **\[ì–´ëŒ‘í„° 1\]** </span>  
**NAT ë„¤íŠ¸ì›Œí¬**  
**ì´ë¦„ : NatNetwork**

### ğŸ’§Rocky Linux ë‚´ë¶€ì˜ IP ì„¤ì • 

![Alt text](/../../images/2023/2023-09-21_2_ubuntu_kube/4.png)  
  
**IPv4 Method : Manual(ìˆ˜ë™)**  
**IP : 192.168.0.10**  
**SM : 255.255.255.0**  
**GW : 192.168.0.1**  
**DNS : 8.8.8.8**

## â­í˜¸ìŠ¤íŠ¸ ì„¤ì •

```bash
sudo su

cat <<EOF> /etc/hosts
192.168.0.10 master
192.168.0.20 worker
EOF

hostnamectl set-hostname master
```

ì¬ë¶€íŒ…í•©ë‹ˆë‹¤.


## â­Swap & SELinux & ë°©í™”ë²½ ì„¤ì •

```bash
sudo su

sudo swapoff -a && sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab
sudo setenforce 0
sudo sed -i --follow-symlinks 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux
sudo systemctl disable firewalld
sudo systemctl stop firewalld
```


## â­Docker ì„¤ì¹˜

[https://docs.docker.com/engine/install/centos/](https://docs.docker.com/engine/install/centos/)
```bash
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y
systemctl enable docker
systemctl start docker
```

## â­ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ì„¤ì •

[https://kubernetes.io/docs/setup/production-environment/container-runtimes/](https://kubernetes.io/docs/setup/production-environment/container-runtimes/)
```bash
sudo su

cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sudo sysctl --system

containerd config default | sudo tee /etc/containerd/config.toml >/dev/null 2>&1

sudo sed -i 's/SystemdCgroup \= false/SystemdCgroup \= true/g' /etc/containerd/config.toml
```


## â­ì¿ ë²„ë„¤í‹°ìŠ¤ ë„êµ¬ ì„¤ì¹˜

[https://pwittrock.github.io/docs/setup/independent/install-kubeadm/](https://pwittrock.github.io/docs/setup/independent/install-kubeadm/)
```bash
cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg
        https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF
setenforce 0
yum install -y kubelet kubeadm
systemctl enable kubelet && systemctl start kubelet

shutdown now
```

## â­master ë…¸ë“œ ë³µì œ

<span style="color:blueviolet"> **master node VMì´ ì¢…ë£Œë˜ë©´ master node VMì„ ë³µì œí•©ë‹ˆë‹¤.** </span>

ë³µì œí•  ë•Œ ì´ë¦„ì€ workerë¡œ í•´ì¤ë‹ˆë‹¤.
  

## â­worker ë…¸ë“œ IP, í˜¸ìŠ¤íŠ¸ëª… ì„¤ì •

<span style="color:blueviolet"> **worker node VMì„ ì‹¤í–‰í•©ë‹ˆë‹¤.** </span>

**IPv4 Method : Manual**  
**IP : 192.168.0.20**  
**SM : 255.255.255.0**  
**GW : 192.168.0.1**  
**DNS : 8.8.8.8**  

ì‚¬ì‹¤ ê·¸ëƒ¥ IP ëìë¦¬ë§Œ ë°”ê¿”ì¤€ ê²ë‹ˆë‹¤. master nodeì™€ ì¤‘ë³µë˜ë©´ ì•ˆë˜ë‹ˆê¹Œìš”.

ë§ˆì°¬ê°€ì§€ë¡œ í˜¸ìŠ¤íŠ¸ëª…ë„ ì¤‘ë³µë˜ë©´ ì•ˆ ë˜ë¯€ë¡œ í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì¤ë‹ˆë‹¤.

```bash
hostnamectl set-hostname worker
```

ê·¸ë¦¬ê³  ì¬ë¶€íŒ…í•©ë‹ˆë‹¤.

## â­Kubernetes Cluster ì„¤ì •

### ğŸ’§kubeadmin init

<span style="color:blueviolet"> **master node VMì„ ì‹¤í–‰í•©ë‹ˆë‹¤.** </span>

```bash
sudo su
sudo kubeadm init --control-plane-endpoint=master
```

ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. ë©ˆì¶˜ ê±° ì•„ë‹ˆì—ìš”ã…‹ã…‹

ë‹¤ ëë‚˜ë©´Â **kubeadm join**Â ì–´ì©Œê³  í•˜ëŠ” ë‚´ìš©ì´ ë§¨ ë’¤ì— ë‚˜ì˜¤ëŠ”ë°, ì´ë¥¼ ë³µì‚¬í•´ì¤ë‹ˆë‹¤.

cat > token.txt ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ë”°ë¡œ ì €ì¥í•´ì£¼ë©´ ë”ìš± ì¢‹ìŠµë‹ˆë‹¤.

í„°ë¯¸ë„ì— ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
exit

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

### ğŸ’§kubeadm join

<span style="color:blueviolet"> **ì´ì œ worker node VMìœ¼ë¡œ ê±´ë„ˆê°‘ë‹ˆë‹¤.** </span>
```bash
sudo su
```  
ê·¸ë¦¬ê³  í„°ë¯¸ë„ì— ì•„ê¹Œ ë³µì‚¬í–ˆë˜ kubeadm join ì–´ì©Œê³  í•˜ëŠ” ê°’ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.

<span style="color:blueviolet"> **ë‹¤ì‹œ master node VMë¡œ ê±´ë„ˆê°€ì„œ,** </span>
```bash
kubectl get nodes
```

ì•„ì§ì€ not ready ìƒíƒœì…ë‹ˆë‹¤.

### Pod Network Addon ì„¤ì¹˜

ì—¬ê¸°ì— pod network addonì„ ì„¤ì¹˜í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

Calico, Flannel ë“±ì´ ìˆìœ¼ë©°, ì´ ì¤‘ì— í•˜ë‚˜ë§Œ ì„¤ì¹˜í•´ì¤˜ë„ ë©ë‹ˆë‹¤.

<span style="color:darkcyan"> **\[Calico\]** </span>
```bash
kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/calico.yaml
```

<span style="color:darkcyan"> **\[Flannel\]** </span>  
[https://github.com/flannel-io/flannel#deploying-flannel-manually](https://github.com/flannel-io/flannel#deploying-flannel-manually)
```bash
kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml
```

```bash
kubectl get nodes
```

ready ìƒíƒœë¡œ ë³€í™˜ë˜ê¸°ê¹Œì§€ ì‹œê°„ì´ ì¢€ ê±¸ë¦½ë‹ˆë‹¤. ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.